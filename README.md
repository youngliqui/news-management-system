## Описание приложения

Это приложение представляет собой систему управления новостями и комментариями, разработанную с использованием **Spring
Boot**. Оно состоит из двух основных модулей:

1. **news-service**: Обрабатывает операции, связанные с новостями и комментариями.
2. **security**: Управляет аутентификацией пользователей и их доступом.

Приложение использует **REST API** для взаимодействия между клиентом и сервером, а также **JWT токен** для обеспечения
безопасности.

## Используемые технологии

- Java 21
- Gradle 8.9
- Spring Boot 3.3.5
- Spring Data JPA
- Spring Security
- Spring Cloud Openfeign
- JWT (JSON Web Token)
- PostgreSQL
- Liquibase
- MapStruct
- Swagger для документирования API
- pg_trgm для полнотекстового поиска

## Основные возможности

### Модуль news-service

- **Управление новостями**:
    - Получение списка всех новостей с пагинацией.
    - Поиск новостей по ключевым словам.
    - Создание, обновление и удаление новостей.

- **Управление комментариями**:
    - Получение всех комментариев к конкретной новости.
    - Создание, обновление, частичное обновление и удаление комментариев.
    - Полнотекстовый поиск комментариев.

### Модуль security

- **Аутентификация**:
    - Регистрация новых пользователей.
    - Вход в систему с получением JWT токена.

- **Управление пользователями**:
    - Получение информации о пользователях.
    - Обновление данных пользователей и изменение пароля.
    - Проверка доступа пользователя по токену.

### Кеширование данных

Реализована возможность использовать `LFU` или `LRU` метод кеширования.
Алгоритм и максимальный размер коллекции считывается из application.yml файла.

Алгоритм работы с кешем:

- **GET**: ищем в кеше и если там данных нет, то достаем объект из
  repository, сохраняем в кеш и возвращаем
- **POST** - сохраняем в repository и потом сохраняем в кеше
- **DELETE** - удаляем из repository и потом удаляем из кеша
- **PUT** - обновление/вставка в repository и потом обновление/вставка в кеше.

## Документация Swagger UI

Информация об эндпоинтах представлена по следующим URL:

- **News-service**: `http://localhost:8081/swagger-ui.html`
- **Security**: `http://localhost:8082/swagger-ui.html`

## Доступные роли у пользователей

- **ADMIN** - может производить CRUD-операции со всеми сущностями.
- **JOURNALIST** - может добавлять и изменять/удалять только свои новости.
- **SUBSCRIBER** - может добавлять и изменять/удалять только свои комментарии.
- **Незарегистрированные пользователи** - могут только просматривать новости и комментарии

Для получения токена нужно аутентифицироваться по URL:
`http://localhost:8082/api/auth/sign-in` с телом запроса содержащим username и password.

## Запуск проекта

Необходимо запустить `docker-compose` файл с помощью команды `docker-compose up -d`
Сначала в news-service модуле, а потом и в security модуле.

Переменные окружения для запуска Docker указаны в `.env` файлах.

Далее просто запускаем основные main классы в модулях.

`news-service/src/main/java/ru/clevertec/NewsServiceApplication`

`security/src/main/java/ru/clevertec/security/SecurityApplication`

## Переменные окружения

```plaintext
POSTGRES_DATABASE=news_service_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_LOCAL_PORT=5430
POSTGRES_DOCKER_PORT=5432

POSTGRES_DATABASE=users_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_LOCAL_PORT=5431
POSTGRES_DOCKER_PORT=5432